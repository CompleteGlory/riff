default_platform(:android)

platform :android do
  desc "Android Firebase App Distribution"
  lane :firebase_distribution do
    # Clean & build release
    sh "flutter clean"
    sh "flutter build apk --release --flavor production --target lib/main_production.dart --no-tree-shake-icons"

    firebase_app_distribution(
      app: "1:369305642937:android:5cc3706f66335b573d7868",
      firebase_cli_token: ENV["FIREBASE_CLI_TOKEN"],
      android_artifact_type: "APK",
      android_artifact_path: "build/app/outputs/flutter-apk/app-production-release.apk", # fixed relative path
      testers: "fadyalaa441@gmail.com, fadyalaa2112@gmail.com, zakymagd@gmail.com",
      upload_timeout: 600,
      release_notes: <<~RELEASE_NOTES
        Version 1.0.2 — Release notes

        Date: 2025-11-04
        Version: 1.0.2

        Highlights (user-facing)
        - Redesigned Home screen: “Discover” left-aligned and pinned; no back button.
        - Fully functional Feed posts:
          - Tap an image to view it full-screen.
          - Working Share button (share system sheet).
          - Like button with animated feedback.
          - Comment button opens inline composer.
        - Bottom navigation visuals: added assets and icons for Feed, Search, Notifications, and Profile.

        Short Play Store blurb
        - “Discover, browse and share — improved Home + full-screen post images, share, animated likes, comments, and polished bottom navigation.”

        Changelog
        - Add: Full-screen image viewer for feed posts.
        - Add: Share button for posts (system share sheet).
        - Add: Like animation and comment composer for feed posts.
        - UI: Home screen left-align and remove back button.
        - Add: Bottom-nav assets for Feed, Search, Notifications, Profile.

        Developer notes
        - Home screen: removed automatic leading/back button, set `automaticallyImplyLeading:false` and `titleSpacing` for left alignment.
        - Feed post interactions:
          - Full-screen image viewer implemented.
          - Post share integrated with platform share intent.
          - Like button triggers animation.
          - Comment button opens inline composer.
        - Bottom navigation: new icons and state preservation between tabs.

        QA checklist
        1. Home
           - Verify “Discover” left aligned and no back button.
        2. Feed
           - Full-screen image, share, like, comment all working.
        3. Bottom navigation
           - Switching tabs preserves state.
        4. Regression
           - No blank screens, login/signup unchanged, smooth scrolling.

        Fastlane short summary:
        Home improvements & Feed interaction: left-aligned header, full-screen post images, working share button, animated likes, comment composer, and new bottom-nav icons.
      RELEASE_NOTES
    )
  end
end
